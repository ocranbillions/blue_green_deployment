- name: "upgrade packages."
  become: true
  apt:
    upgrade: "yes"

- name: Configure server/ install docker
  shell: |
    git clone https://github.com/ocranbillions/blue_green_deployment.git
    cd blue_green_deployment

    wget -qO- https://get.docker.com/ | sh
    sudo usermod -aG docker ubuntu

- name: Install minikube
  shell: |
    sudo wget https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    sudo mv minikube-linux-amd64 /usr/local/bin/minikube
    sudo chmod 755 /usr/local/bin/minikube

- name: Install kubectl
  shell: |
    sudo apt-get update
    sudo apt-get install -y apt-transport-https ca-certificates curl
    sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
    echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list
    sudo apt-get update
    sudo apt-get install -y kubelet kubeadm kubectl
    sudo apt-mark hold kubelet kubeadm kubectl

# The below steps are run manually (specified as optional in the rubric)
# - name: Run minikube
#   shell: |
#     sudo su - ubuntu
#     minikube start --driver=docker

# - name: Start application
#   shell: |
#     . run_kubernetes.sh